# Define the network share path
$source = "\\dcs124pw3dp.svc.ny.gov\NYS_BOOT\files"

# Try to get the file list
try {
    $files = Get-ChildItem -Path $source -File
} catch {
    Write-Host "Error accessing the network path. Make sure you're connected and have permission." -ForegroundColor Red
    return
}

# Check if any files were found
if ($files.Count -eq 0) {
    Write-Host "No files found in the directory." -ForegroundColor Yellow
    return
}

# List files with numbers
Write-Host "Files found in the directory:`n"
$i = 1
$files | ForEach-Object {
    Write-Host "$i. $($_.Name)"
    $i++
}

# Prompt user
$choice = Read-Host "`nDo you want to download all files? (Y/N/Select by number, comma-separated like 1,3,5)"

# Destination folder
$destination = "C:\Users\$env:USERNAME\Downloads\NYS_BOOT"
if (!(Test-Path -Path $destination)) {
    New-Item -ItemType Directory -Path $destination | Out-Null
}

# Download
switch -Regex ($choice) {
    "^y$" {
        # Download all files
        $files | ForEach-Object {
            Copy-Item -Path $_.FullName -Destination $destination -Force
        }
        Write-Host "All files copied to $destination" -ForegroundColor Green
    }
    "^\d+(,\d+)*$" {
        # Download selected files by index
        $indices = $choice -split "," | ForEach-Object { ($_ -as [int]) - 1 }
        foreach ($index in $indices) {
            if ($index -ge 0 -and $index -lt $files.Count) {
                $file = $files[$index]
                Copy-Item -Path $file.FullName -Destination $destination -Force
                Write-Host "Copied: $($file.Name)"
            } else {
                Write-Host "Invalid selection: $($index + 1)" -ForegroundColor Yellow
            }
        }
    }
    default {
        Write-Host "No files copied. Exiting." -ForegroundColor Yellow
    }
}